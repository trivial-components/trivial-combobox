/*! Trivial Components | (c) 2015 Yann Massard and others | Apache License, Version 2.0 (https://raw.githubusercontent.com/trivial-components/trivial-components/master/LICENSE) */
!function(t){if("object"==typeof module&&"object"==typeof module.exports){var e=t(require,exports);void 0!==e&&(module.exports=e)}else"function"==typeof define&&define.amd?define(["require","exports","jquery","mustache","./TrivialCore","./TrivialEvent"],t):(window.TrivialComponents=window.TrivialComponents||{},t(function(t){return"jquery"===t?window.jQuery:"levenshtein"===t?window.Levenshtein:"moment"===t?window.moment:"mustache"===t?window.Mustache:window.TrivialComponents},window.TrivialComponents))}(function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=t("jquery"),n=t("mustache"),r=t("./TrivialCore"),s=t("./TrivialEvent"),o=function(){function t(t,e){void 0===e&&(e={}),this.onSelectedEntryChanged=new s.TrivialEvent(this),this.config=i.extend({entryRenderingFunction:function(t){var e=t.template||r.DEFAULT_TEMPLATES.image2LinesTemplate;return n.render(e,t)},selectedEntry:null,entries:null,matchingOptions:{matchingMode:"contains",ignoreCase:!0,maxLevenshteinDistance:1},noEntriesTemplate:r.DEFAULT_TEMPLATES.defaultNoEntriesTemplate},e),this.$listBox=i('<div class="tr-listbox"/>').appendTo(t);var o=this;this.$listBox.on("mousedown",".tr-listbox-entry",function(t){o.setSelectedEntry(i(this).data("entry"),t,!0)}).on("mouseup",".tr-listbox-entry",function(t){o.$listBox.trigger("mouseup",t)}).on("mouseenter",".tr-listbox-entry",function(t){o.setHighlightedEntry(i(this).data("entry"))}).on("mouseleave",".tr-listbox-entry",function(t){i(t.toElement).is(".tr-listbox-entry")||o.setHighlightedEntry(null)}),this.$entryList=i('<div class="tr-listbox-entry-list"></div>').appendTo(this.$listBox),this.config.entries&&(this.entries=this.config.entries,this.updateEntryElements(this.entries)),this.$listBox.data("trivialListBox",this)}return t.prototype.updateEntryElements=function(t){if(this.$entryList.detach(),this.$entryList.empty(),t.length>0)for(var e=0;e<t.length;e++){var n=t[e],r=void 0;if(n._trEntryElement)r=n._trEntryElement;else{var s=this.config.entryRenderingFunction(n);r=i(s).addClass("tr-listbox-entry filterable-item")}r.appendTo(this.$entryList).data("entry",n),n._trEntryElement=r}else this.$entryList.append(this.config.noEntriesTemplate);this.$entryList.appendTo(this.$listBox)},t.prototype.updateEntries=function(t){null==t&&(t=[]),this.setHighlightedEntry(null),this.entries=t,this.updateEntryElements(this.entries)},t.prototype.minimallyScrollTo=function(t){r.minimallyScrollTo(this.$listBox.parent(),t)},t.prototype.setHighlightedEntry=function(t){t!==this.highlightedEntry&&(this.highlightedEntry=t,this.$entryList.find(".tr-listbox-entry").removeClass("tr-highlighted-entry"),null!=t&&(t._trEntryElement.addClass("tr-highlighted-entry"),this.minimallyScrollTo(t._trEntryElement)))},t.prototype.fireChangeEvents=function(t,e){this.$listBox.trigger("change"),this.onSelectedEntryChanged.fire(t,e)},t.prototype.setSelectedEntry=function(t,e,i){void 0===i&&(i=!1),this.selectedEntry=t,this.$entryList.find(".tr-selected-entry").removeClass("tr-selected-entry"),null!=t&&this.selectedEntry._trEntryElement.addClass("tr-selected-entry"),i&&this.fireChangeEvents(this.selectedEntry,e)},t.prototype.highlightNextEntry=function(t){var e=this.getNextHighlightableEntry(t);null!=e&&this.setHighlightedEntry(e)},t.prototype.getNextHighlightableEntry=function(t){var e;if(null==this.entries||0==this.entries.length)return null;if(null==this.highlightedEntry&&t>0)e=-1+t;else if(null==this.highlightedEntry&&t<0)e=this.entries.length+t;else{var i=this.entries.indexOf(this.highlightedEntry);e=(i+this.entries.length+t)%this.entries.length}return this.entries[e]},t.prototype.highlightTextMatches=function(t){for(var e=0;e<this.entries.length;e++){var i=this.entries[e]._trEntryElement;i.trivialHighlight(t,this.config.matchingOptions)}},t.prototype.getSelectedEntry=function(){if(this.selectedEntry){var t=i.extend({},this.selectedEntry);return delete t._trEntryElement,t}return null},t.prototype.getHighlightedEntry=function(){return this.highlightedEntry},t.prototype.navigate=function(t){"up"===t?this.highlightNextEntry(-1):"down"===t&&this.highlightNextEntry(1)},t.prototype.getMainDomElement=function(){return this.$listBox[0]},t.prototype.destroy=function(){this.$listBox.remove()},t}();e.TrivialListBox=o});